{% extends 'base.html' %}
{% block title %}Buscar Animales en {{ raza.nombre }}{% endblock %}
{% block content %}
<h2>Buscar Animales en {{ raza.nombre }}</h2>
<form method="get" class="row g-2 mb-4">
    <div class="col-md-2"><input class="form-control" name="rp" placeholder="RP" value="{{ request.args.get('rp','') }}"></div>
    <div class="col-md-2"><input class="form-control" name="nombre" placeholder="Nombre" value="{{ request.args.get('nombre','') }}"></div>
    <div class="col-md-2"><input class="form-control" name="padre" placeholder="Padre" value="{{ request.args.get('padre','') }}"></div>
    <div class="col-md-2"><input class="form-control" name="madre" placeholder="Madre" value="{{ request.args.get('madre','') }}"></div>
    <div class="col-md-2">
        <select class="form-select" name="sexo">
            <option value="">Sexo</option>
            <option value="Macho" {% if request.args.get('sexo') == 'Macho' %}selected{% endif %}>Macho</option>
            <option value="Hembra" {% if request.args.get('sexo') == 'Hembra' %}selected{% endif %}>Hembra</option>
        </select>
    </div>
    <div class="col-md-2"><input class="form-control" type="date" name="fecha_nac_min" placeholder="Fecha Nac. desde" value="{{ request.args.get('fecha_nac_min','') }}"></div>
    <div class="col-md-2"><input class="form-control" type="date" name="fecha_nac_max" placeholder="Fecha Nac. hasta" value="{{ request.args.get('fecha_nac_max','') }}"></div>
    {% for campo in ['pezuñas', 'ubres_pezones', 'manos', 'garrones', 'patas_atras', 'articulacion'] %}
    <div class="col-md-1">
        <input class="form-control" type="number" min="0" name="{{ campo }}_min" placeholder="{{ campo|capitalize }} min" value="{{ request.args.get(campo~'_min','') }}">
    </div>
    <div class="col-md-1">
        <input class="form-control" type="number" min="0" name="{{ campo }}_max" placeholder="{{ campo|capitalize }} max" value="{{ request.args.get(campo~'_max','') }}">
    </div>
    {% endfor %}
    <div class="col-md-12 mt-2">
        <button class="btn btn-primary">Buscar</button>
        <a class="btn btn-secondary" href="{{ url_for('ver_raza', raza_id=raza.id) }}">Volver</a>
    </div>
</form>
<p>Cantidad de resultados: <b>{{ cantidad }}</b></p>
<table class="table table-bordered table-hover table-sm">
    <thead>
        <tr>
            <th>RP</th>
            <th>Nombre</th>
            <th>Sexo</th>
            <th>Fecha Nac.</th>
            <th>Padre</th>
            <th>Madre</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for animal in animales %}
        <tr>
            <td>{{ animal.rp }}</td>
            <td>{{ animal.nombre }}</td>
            <td>{{ animal.sexo }}</td>
            <td>{{ animal.fecha_nac.strftime('%Y-%m-%d') if animal.fecha_nac }}</td>
            <td>{{ animal.padre }}</td>
            <td>{{ animal.madre }}</td>
            <td>
                <a href="{{ url_for('ficha_animal', id=animal.id) }}" class="btn btn-info btn-sm">Ver</a>
                <a href="{{ url_for('editar_animal', id=animal.id) }}" class="btn btn-warning btn-sm">Editar</a>
                <form action="{{ url_for('eliminar_animal', id=animal.id) }}" method="post" style="display:inline;" onsubmit="return confirm('¿Eliminar animal {{ animal.rp }}?');">
                    <button type="submit" class="btn btn-danger btn-sm">Eliminar</button>
                </form>
            </td>
        </tr>
        {% endfor %}
        {% if animales|length == 0 %}
        <tr><td colspan="7" class="text-center">Sin resultados.</td></tr>
        {% endif %}
    </tbody>
</table>
{% endblock %}