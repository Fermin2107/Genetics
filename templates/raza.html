{% extends "base.html" %}
{% block content %}
<h1 class="mb-4">Animales de la raza: {{ raza.nombre }}</h1>

<div style="display: flex; gap: 1rem; align-items: center; margin-bottom: 1rem;">
    <a href="{{ url_for('registrar_animal', raza_id=raza.id) }}" class="btn btn-primary">Registrar Nuevo Animal</a>

    <!-- Formulario para subir Excel -->
    <form method="post" action="{{ url_for('actualizar_epds_excel', raza_id=raza.id) }}" enctype="multipart/form-data" style="display: inline;">
        <input type="file" name="archivo" accept=".xls,.xlsx" required>
        <button type="submit" class="btn btn-success">Actualizar EPDs por Excel</button>
    </form>
</div>

<!-- ...filtros y el resto de tu template... -->

<form method="get" class="row g-2 mb-4">
    <div class="col-md-2"><input type="text" class="form-control" name="rp" placeholder="RP" value="{{ request.args.get('rp', '') }}"></div>
    <div class="col-md-2"><input type="text" class="form-control" name="nombre" placeholder="Nombre" value="{{ request.args.get('nombre', '') }}"></div>
    <div class="col-md-2"><input type="text" class="form-control" name="padre" placeholder="Padre" value="{{ request.args.get('padre', '') }}"></div>
    <div class="col-md-2"><input type="text" class="form-control" name="madre" placeholder="Madre" value="{{ request.args.get('madre', '') }}"></div>
    <div class="col-md-2"><input type="text" class="form-control" name="sexo" placeholder="Sexo" value="{{ request.args.get('sexo', '') }}"></div>
    <div class="col-md-2"><input type="date" class="form-control" name="fecha_nac_min" placeholder="mm/dd/yyyy" value="{{ request.args.get('fecha_nac_min', '') }}"></div>
    <div class="col-md-2"><input type="date" class="form-control" name="fecha_nac_max" placeholder="mm/dd/yyyy" value="{{ request.args.get('fecha_nac_max', '') }}"></div>

    <div class="col-md-2"><input type="number" step="any" class="form-control" name="pezuñas_min" placeholder="Pezuñas mín" value="{{ request.args.get('pezuñas_min', '') }}"></div>
    <div class="col-md-2"><input type="number" step="any" class="form-control" name="pezuñas_max" placeholder="Pezuñas máx" value="{{ request.args.get('pezuñas_max', '') }}"></div>

    <div class="col-md-2"><input type="number" step="any" class="form-control" name="articulacion_min" placeholder="Articulación mín" value="{{ request.args.get('articulacion_min', '') }}"></div>
    <div class="col-md-2"><input type="number" step="any" class="form-control" name="articulacion_max" placeholder="Articulación máx" value="{{ request.args.get('articulacion_max', '') }}"></div>

    <div class="col-md-2"><input type="number" step="any" class="form-control" name="clase_min" placeholder="Clase mín" value="{{ request.args.get('clase_min', '') }}"></div>
    <div class="col-md-2"><input type="number" step="any" class="form-control" name="clase_max" placeholder="Clase máx" value="{{ request.args.get('clase_max', '') }}"></div>

    <div class="col-md-2">
        <select name="orden" class="form-select">
            <option value="asc" {% if orden == 'asc' %}selected{% endif %}>RP Ascendente</option>
            <option value="desc" {% if orden == 'desc' %}selected{% endif %}>RP Descendente</option>
        </select>
    </div>
    <div class="col-md-2">
        <button type="submit" class="btn btn-outline-secondary w-100">Filtrar</button>
    </div>
</form>

<p>Total: <b>{{ total }}</b></p>

<table class="table table-bordered align-middle">
    <thead class="table-light">
        <tr>
            <th>RP</th>
            <th>Nombre</th>
            <th>Sexo</th>
            <th>Fecha Nac.</th>
            <th>Padre</th>
            <th>Madre</th>
            <th>Pezuñas</th>
            <th>Articulación</th>
            <th>Clase</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for animal in animales %}
        <tr>
            <td><a href="{{ url_for('ficha_animal', id=animal.id) }}">{{ animal.rp }}</a></td>
            <td><a href="{{ url_for('ficha_animal', id=animal.id) }}">{{ animal.nombre }}</a></td>
            <td>{{ animal.sexo }}</td>
            <td>{{ animal.fecha_nac or '' }}</td>
            <td><a href="#">{{ animal.padre }}</a></td>
            <td><a href="#">{{ animal.madre }}</a></td>
            <td>{{ animal.pezuñas }}</td>
            <td>{{ animal.articulacion }}</td>
            <td>{{ animal.clase }}</td>
            <td>
                <a href="{{ url_for('ficha_animal', id=animal.id) }}" class="btn btn-info btn-sm">Ver</a>
                <a href="{{ url_for('editar_animal', id=animal.id) }}" class="btn btn-warning btn-sm">Editar</a>
                <form method="post" action="{{ url_for('eliminar_animal', id=animal.id) }}" style="display:inline;">
                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('¿Seguro que quieres eliminar?')">Eliminar</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<a href="{{ url_for('razas') }}" class="btn btn-secondary mt-3">Volver a Razas</a>
{% endblock %}


