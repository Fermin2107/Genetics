{% extends "base.html" %}
{% block content %}
<h1 class="mt-4 mb-3">Animales de la raza: {{ raza.nombre }}</h1>

<div class="d-flex flex-wrap mb-3 gap-2">
  <a href="{{ url_for('registrar_animal', raza_id=raza.id) }}" class="btn btn-primary">Registrar Nuevo Animal</a>
</div>

<form class="row g-2 mb-3" method="get" action="{{ url_for('ver_raza', raza_id=raza.id) }}">
  <div class="col-auto">
    <input type="text" name="rp" class="form-control" placeholder="RP" value="{{ request.args.get('rp', '') }}">
  </div>
  <div class="col-auto">
    <input type="text" name="nombre" class="form-control" placeholder="Nombre" value="{{ request.args.get('nombre', '') }}">
  </div>
  <div class="col-auto">
    <input type="text" name="padre" class="form-control" placeholder="Padre" value="{{ request.args.get('padre', '') }}">
  </div>
  <div class="col-auto">
    <input type="text" name="madre" class="form-control" placeholder="Madre" value="{{ request.args.get('madre', '') }}">
  </div>
  <div class="col-auto">
    <input type="date" name="fecha_nac_min" class="form-control" placeholder="Fecha Nac. desde" value="{{ request.args.get('fecha_nac_min', '') }}">
  </div>
  <div class="col-auto">
    <input type="date" name="fecha_nac_max" class="form-control" placeholder="Fecha Nac. hasta" value="{{ request.args.get('fecha_nac_max', '') }}">
  </div>
  <!-- Campos de rango: pezuñas, manos, garrones, patas_atras, articulacion, ubres_pezones -->
  <div class="col-auto">
    <input type="text" name="pezuñas_min" class="form-control" placeholder="Pezuñas mín" value="{{ request.args.get('pezuñas_min', '') }}">
  </div>
  <div class="col-auto">
    <input type="text" name="pezuñas_max" class="form-control" placeholder="Pezuñas máx" value="{{ request.args.get('pezuñas_max', '') }}">
  </div>
  <div class="col-auto">
    <input type="text" name="manos_min" class="form-control" placeholder="Manos mín" value="{{ request.args.get('manos_min', '') }}">
  </div>
  <div class="col-auto">
    <input type="text" name="manos_max" class="form-control" placeholder="Manos máx" value="{{ request.args.get('manos_max', '') }}">
  </div>
  <div class="col-auto">
    <input type="text" name="garrones_min" class="form-control" placeholder="Garrones mín" value="{{ request.args.get('garrones_min', '') }}">
  </div>
  <div class="col-auto">
    <input type="text" name="garrones_max" class="form-control" placeholder="Garrones máx" value="{{ request.args.get('garrones_max', '') }}">
  </div>
  <div class="col-auto">
    <input type="text" name="patas_atras_min" class="form-control" placeholder="Patas Atrás mín" value="{{ request.args.get('patas_atras_min', '') }}">
  </div>
  <div class="col-auto">
    <input type="text" name="patas_atras_max" class="form-control" placeholder="Patas Atrás máx" value="{{ request.args.get('patas_atras_max', '') }}">
  </div>
  <div class="col-auto">
    <input type="text" name="articulacion_min" class="form-control" placeholder="Articulación mín" value="{{ request.args.get('articulacion_min', '') }}">
  </div>
  <div class="col-auto">
    <input type="text" name="articulacion_max" class="form-control" placeholder="Articulación máx" value="{{ request.args.get('articulacion_max', '') }}">
  </div>
  <div class="col-auto">
    <input type="text" name="ubres_pezones_min" class="form-control" placeholder="Ubres/Pezones mín" value="{{ request.args.get('ubres_pezones_min', '') }}">
  </div>
  <div class="col-auto">
    <input type="text" name="ubres_pezones_max" class="form-control" placeholder="Ubres/Pezones máx" value="{{ request.args.get('ubres_pezones_max', '') }}">
  </div>
  <div class="col-auto">
    <select name="sexo" class="form-select">
      <option value="">Sexo: Todos</option>
      <option value="Macho" {% if request.args.get('sexo') == 'Macho' %}selected{% endif %}>Macho</option>
      <option value="Hembra" {% if request.args.get('sexo') == 'Hembra' %}selected{% endif %}>Hembra</option>
    </select>
  </div>
  <div class="col-auto">
    <select name="orden" class="form-select">
      <option value="asc" {% if orden == 'asc' %}selected{% endif %}>RP Ascendente</option>
      <option value="desc" {% if orden == 'desc' %}selected{% endif %}>RP Descendente</option>
    </select>
  </div>
  <div class="col-auto">
    <button class="btn btn-outline-secondary" type="submit">Filtrar</button>
  </div>
</form>

<p class="mb-1">Total: <b>{{ total }}</b></p>

<div class="table-responsive">
  <table class="table table-bordered align-middle">
    <thead>
      <tr>
        <th>RP</th>
        <th>Nombre</th>
        <th>Sexo</th>
        <th>Fecha Nac.</th>
        <th>Padre</th>
        <th>Madre</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for animal in animales %}
      <tr>
        <td>
          <a href="{{ url_for('ficha_animal', id=animal.id) }}">{{ animal.rp }}</a>
        </td>
        <td>
          <a href="{{ url_for('ficha_animal', id=animal.id) }}">{{ animal.nombre }}</a>
        </td>
        <td>{{ animal.sexo }}</td>
        <td>{% if animal.fecha_nac %}{{ animal.fecha_nac.strftime('%Y-%m-%d') }}{% endif %}</td>
        <td>
          {% set padre = animales|selectattr("rp", "equalto", animal.padre)|first or animales|selectattr("nombre", "equalto", animal.padre)|first %}
          {% if padre %}
            <a href="{{ url_for('ficha_animal', id=padre.id) }}">{{ animal.padre }}</a>
          {% else %}
            {{ animal.padre }}
          {% endif %}
        </td>
        <td>
          {% set madre = animales|selectattr("rp", "equalto", animal.madre)|first or animales|selectattr("nombre", "equalto", animal.madre)|first %}
          {% if madre %}
            <a href="{{ url_for('ficha_animal', id=madre.id) }}">{{ animal.madre }}</a>
          {% else %}
            {{ animal.madre }}
          {% endif %}
        </td>
        <td>
          <a href="{{ url_for('ficha_animal', id=animal.id) }}" class="btn btn-sm btn-info">Ver</a>
          <a href="{{ url_for('editar_animal', id=animal.id) }}" class="btn btn-sm btn-warning">Editar</a>
          <form action="{{ url_for('eliminar_animal', id=animal.id) }}" method="post" style="display:inline;" onsubmit="return confirm('¿Seguro que deseas eliminar este animal?');">
            <button type="submit" class="btn btn-sm btn-danger">Eliminar</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<a href="{{ url_for('razas') }}" class="btn btn-secondary mt-3">Volver a Razas</a>
{% endblock %}
