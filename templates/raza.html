{% extends "base.html" %}
{% block content %}
<h1 class="mb-4">Animales de la raza: {{ raza.nombre }}</h1>

<!-- Botones de acción -->
<div class="d-flex flex-wrap gap-2 align-items-center mb-3">
    <a href="{{ url_for('registrar_animal', raza_id=raza.id) }}" class="btn btn-primary">Registrar Nuevo Animal</a>
    <form method="post" action="{{ url_for('actualizar_epds_excel', raza_id=raza.id) }}" enctype="multipart/form-data" class="d-inline-flex gap-2">
        <input type="file" name="archivo" class="form-control" accept=".xls,.xlsx" required>
        <button type="submit" class="btn btn-success flex-shrink-0">Actualizar EPDs</button>
    </form>
</div>

<!-- Formulario de filtros con estética limpia -->
<form action="{{ url_for('ver_raza', raza_id=raza.id) }}" method="get" class="row g-2 mb-4">
    <!-- Fila 1 -->
    <div class="col-md-2">
        <input type="text" class="form-control" name="rp" placeholder="RP" value="{{ request.args.get('rp', '') }}">
    </div>
    <div class="col-md-2">
        <input type="text" class="form-control" name="nombre" placeholder="Nombre" value="{{ request.args.get('nombre', '') }}">
    </div>
    <div class="col-md-2">
        <input type="text" class="form-control" name="padre" placeholder="Padre" value="{{ request.args.get('padre', '') }}">
    </div>
    <div class="col-md-2">
        <input type="text" class="form-control" name="madre" placeholder="Madre" value="{{ request.args.get('madre', '') }}">
    </div>
    <div class="col-md-2">
        <select name="sexo" class="form-select">
            <option value="">Ambos Sexos</option>
            <option value="Macho" {% if request.args.get('sexo') == 'Macho' %}selected{% endif %}>Macho</option>
            <option value="Hembra" {% if request.args.get('sexo') == 'Hembra' %}selected{% endif %}>Hembra</option>
        </select>
    </div>
    <div class="col-md-2">
        <input type="date" class="form-control" name="fecha_nac_min" title="Fecha de nacimiento mínima" value="{{ request.args.get('fecha_nac_min', '') }}">
    </div>
    
    <!-- Fila 2 -->
    <div class="col-md-2">
        <input type="date" class="form-control" name="fecha_nac_max" title="Fecha de nacimiento máxima" value="{{ request.args.get('fecha_nac_max', '') }}">
    </div>
    <div class="col-md-2">
        <input type="number" step="any" class="form-control" name="pezuñas_min" placeholder="Pezuñas mín" value="{{ request.args.get('pezuñas_min', '') }}">
    </div>
    <div class="col-md-2">
        <input type="number" step="any" class="form-control" name="pezuñas_max" placeholder="Pezuñas máx" value="{{ request.args.get('pezuñas_max', '') }}">
    </div>
    <div class="col-md-2">
        <input type="number" step="any" class="form-control" name="articulacion_min" placeholder="Articulación mín" value="{{ request.args.get('articulacion_min', '') }}">
    </div>
    <div class="col-md-2">
        <input type="number" step="any" class="form-control" name="articulacion_max" placeholder="Articulación máx" value="{{ request.args.get('articulacion_max', '') }}">
    </div>
    <div class="col-md-2">
        <input type="number" step="any" class="form-control" name="valoracion_min" placeholder="Valoracion mín" value="{{ request.args.get('valoracion_min', '') }}">
    </div>

    <!-- Fila 3 -->
    <div class="col-md-2">
        <input type="number" step="any" class="form-control" name="valoracion_max" placeholder="Valoracion máx" value="{{ request.args.get('valoracion_max', '') }}">
    </div>
    <div class="col-md-2">
        <select name="orden" class="form-select">
            <option value="asc" {% if orden == 'asc' %}selected{% endif %}>RP Ascendente</option>
            <option value="desc" {% if orden == 'desc' %}selected{% endif %}>RP Descendente</option>
        </select>
    </div>
    <div class="col-md-2">
        <button type="submit" class="btn btn-outline-secondary w-100">Filtrar</button>
    </div>
</form>

<p>Total de animales mostrados: <b>{{ total }}</b></p>

<div class="table-responsive">
    <table class="table table-bordered table-striped table-hover align-middle">
        <thead class="table-light">
            <tr>
                <th>RP</th>
                <th>Nombre</th>
                <th>Sexo</th>
                <th>Fecha Nac.</th>
                <th>Padre</th>
                <th>Madre</th>
                <th>Valoracion</th>
                <th>Clase</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for animal in animales %}
            <tr>
                <td><a href="{{ url_for('ficha_animal', id=animal.id) }}">{{ animal.rp or 'N/A' }}</a></td>
                <td><a href="{{ url_for('ficha_animal', id=animal.id) }}">{{ animal.nombre }}</a></td>
                <td>{{ animal.sexo }}</td>
                <td>{{ animal.fecha_nac.strftime('%d/%m/%Y') if animal.fecha_nac else '' }}</td>
                <td><a href="{{ url_for('ver_raza', raza_id=raza.id, padre=animal.padre) }}">{{ animal.padre }}</a></td>
                <td><a href="{{ url_for('ver_raza', raza_id=raza.id, madre=animal.madre) }}">{{ animal.madre }}</a></td>
                <td>{{ animal.valoracion }}</td>
                <td>{{ animal.clase }}</td>
                <td>
                    <div class="d-flex gap-1">
                        <a href="{{ url_for('ficha_animal', id=animal.id) }}" class="btn btn-info btn-sm">Ver</a>
                        <a href="{{ url_for('editar_animal', id=animal.id) }}" class="btn btn-warning btn-sm">Editar</a>
                        <form method="post" action="{{ url_for('eliminar_animal', id=animal.id) }}" style="display:inline;" onsubmit="return confirm('¿Estás seguro de que quieres eliminar este animal?');">
                            <button type="submit" class="btn btn-danger btn-sm">Eliminar</button>
                        </form>
                    </div>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="10" class="text-center">No se encontraron animales con los filtros aplicados.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<a href="{{ url_for('razas') }}" class="btn btn-secondary mt-3">Volver a Razas</a>
{% endblock %}



